# 迭代任务拆解（Issue List）

## 使用方式
- 每个任务可直接复制到 GitHub/Gitee Issue。
- 建议字段: 标题、背景、范围、验收标准、优先级、预计工时。

## P0（必须优先）

### Issue 1: 修复前端中文乱码
- 背景: `newtab.js` 当前存在中文字符串编码异常风险。
- 目标: 全量前端文件中文显示正常。
- 范围:
  - `newtab.js`
  - `newtab.html`
  - `options.html`
  - `styles.css`
- 验收标准:
  1. 页面所有中文文案正常显示。
  2. 保存/刷新后文案无乱码。
  3. 提交前通过基础语法检查。

### Issue 2: 增加时间配置合法性校验
- 背景: 当前未校验上下班和午休时间顺序。
- 目标: 阻止非法时间组合并提示用户。
- 规则:
  - `workStart < lunchStart < lunchEnd < workEnd`
  - `workHoursPerDay > 0`
- 验收标准:
  1. 非法输入时不可保存。
  2. 显示明确错误提示（字段级或表单级）。
  3. 合法输入可正常保存。

### Issue 3: 增加“恢复默认设置”按钮
- 背景: 用户修改后难以快速回到默认值。
- 目标: 一键恢复默认并立即生效。
- 验收标准:
  1. 点击后恢复默认配置。
  2. `chrome.storage.sync` 同步更新。
  3. 新标签页数据立即重算。

## P1（重要）

### Issue 4: 抽离计算逻辑为独立模块
- 背景: 计算逻辑集中在 `newtab.js`，后续维护成本高。
- 目标: 将计算函数模块化，降低耦合。
- 建议:
  - 新增 `src/domain/calc.js`（或 TS 版本）
  - 暴露函数:
    - `parseMinutes`
    - `getTodayWorkingSeconds`
    - `getDayProgressPercent`
    - `getDailyIncome`
- 验收标准:
  1. UI 层只做渲染与事件处理。
  2. 原有功能行为不变。

### Issue 5: 为核心计算补单元测试
- 背景: 时间边界逻辑容易回归。
- 目标: 覆盖关键时间场景。
- 用例:
  - 上班前
  - 午休前/午休中/午休后
  - 下班后
  - 配置边界（短工时、极值）
- 验收标准:
  1. 核心函数覆盖率 >= 90%（语句）。
  2. 关键边界场景全部通过。

### Issue 6: 统一设置入口体验
- 背景: 新标签页弹窗设置与 options 页面有重复实现。
- 目标: 统一字段和交互反馈。
- 验收标准:
  1. 两入口字段完全一致。
  2. 保存后反馈文案一致。
  3. 代码重复度下降。

## P2（增强）

### Issue 7: 增加今日预计总收入与剩余可赚金额
- 目标: 增强信息完整度与激励感。
- 验收标准:
  1. 展示“预计今日收入”。
  2. 展示“今日剩余可赚”。
  3. 与当前配置和时间保持一致。

### Issue 8: 增加历史统计（近 7 天）
- 目标: 支持趋势观察。
- 方案建议:
  - 本地按天存储聚合值
  - 新增简易折线/柱状视图
- 验收标准:
  1. 可查看近 7 天数据。
  2. 新的一天自动创建记录。

### Issue 9: 多币种与本地化
- 目标: 支持不同地区用户。
- 范围:
  - 币种符号
  - 文案语言包
- 验收标准:
  1. 支持至少 2 种币种。
  2. 支持至少中英双语。

## 推荐里程碑
- Milestone A（1 周）: Issue 1, 2, 3
- Milestone B（1-2 周）: Issue 4, 5, 6
- Milestone C（2 周）: Issue 7, 8, 9
